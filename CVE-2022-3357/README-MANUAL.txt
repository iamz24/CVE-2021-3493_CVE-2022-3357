***HOW TO SETUP FOR LAB EXPLOIT CVE-2022-3357***

1. Tải Kali Linux VMWare từ link https://www.kali.org/get-kali/#kali-virtual-machines (Ở đây chúng ta làm lab nên chỉ cần dùng bản setup sẵn là đủ)
2. Tiến hành down về, giải nén thành 2 bản kali và scan vào vmware
3. Đặt tên là Kali01, Kali02, máy 01 đóng vai trò server - victim, máy 02 đóng vai trò máy exploit - attacker
4. Trên máy kali01, tiến hành tải XAMPP, WORDPRESS, VSCode bản bất kì (riêng vscode có thể tùy ý cài hoặc không, dùng để review code cho dễ)
5. Tiến hành dùng lệnh 'unzip + tên file zip của wordpress' để giải nén WordPress
6. Dùng lệnh 'sudo ./<tên file>' để chạy cài đặt, sau đó tiến hành cài đặt, lệnh start, stop, restart xampp là 'sudo /opt/lampp/lampp restart/start/stop'
7. Tiến hành đổi domain mặc định local host của xampp thành domain khác (ở đây là nguyenvietdung.com) bằng cách: 
	+ Trỏ nguyenvietdung.com về 127.0.0.1 trong file /etc/host
8. Tiến hành copy file wordpress đã giải nén từ /home/kali/Downloads/ vào file htdocs của xampp trong /opt/lampp/htdocs/, sau đó cấp quyền đọc ghi cho other để tiện cho các cấu hình bên dưới
9. Tuy cập vào nguyenvietdung.com/wordpress, màn hình đăng kí wordpress hiện lên và ta thực hiện theo yêu cầu 
*Chú ý: Database Host phải đổi thành nguyenvietdung.com (domain mà đã được chèn để thay thế local host)
10. Sau đó wordpress sẽ tự tạo ra một file wp-config.php vào trong file /opt/lampp/htdocs/wordpress, và nhờ việc cấp quyền từ bước số 8 nên điều này sẽ được làm auto, nếu không ta phải tự tạo file và đưa code vào
11. Trong trang tiếp theo, site title là tiêu đề web, username là tên đăng nhập, pass là mật khẩu, email là email cá nhân, tất cả đều là tùy chọn theo ý muốn
12. Hiển thị trang welcome to wordpress là cài wp thành công, từ nay đường dẫn http://nguyenvietdung.com/wordpress/wp-admin/ là đường dẫn tới bảng điều khiển của wordpress trên domain nguyenvietdung.com
13. Tiến hành dùng waybackmachine để quay ngược trang web https://vi.wordpress.org/plugins/smart-slider-3/ để tải bản smartslider3 phù hợp với lab (version < 3.5.1.11)  khuyến khích dùng càng gần bản 3.5.1.11 càng tốt vì để tránh gây xung đột với Wordpress. Ở đây dùng  bản 3.5.1.7 được capture vào ngày 9/6/2022
14. Ở bước này ta cần đảm bảo file wp-admin và wp-content đã được cấp đọc ghi cho others, điều này đã được đảm bảo ở bước số 8
15. Vào trang điều khiển của WP -> chọn plugins -> Add new plugins -> Upload plugin -> browse tới file zip của smartslider3, install now
16. Ở đây wp yêu cầu hostname -> domain -> nguyenvietdung.com, ftp user và pass chính là user và pass của máy kali01. Tuy nhiên ta phải kiểm trả cổng 21 tức dịch vụ ftp trước, ta nmap loopback 'sudo nmap -sT 127.0.0.1 -p21' nếu trả về là open thì tiến tới bước số 17, còn close thì làm theo các bước dưới:
	+ sudo apt update -> sudo apt install vsftpd
	+ sudo nano /etc/vsftpdconf -> bỏ cmt dòng write_enable=YES, bỏ cmt dòng pasv_enable=YES, nếu không có thì chủ động thêm vào
	+ sudo service vsftpd restart
	+ sudo apt install ufw
	+ sudo ufw allow 21
17. sau khi nhập đầy đủ thông tin xong thì plugin smartslider3 đã được đẩy vào wp, chúng ta tiếp tục activate nó là xong
18. Tiếp tục với máy kali02, ta trỏ nguyenvietdung.com vào ip của máy kali01
19. Ta thử vào browser để tải thử nguyenvietdung.com như bên kali01 và được kết quả y hệt, các đường link vẫn vậy
20. Tải visual studio sau đó giải nén -> trỏ tới /opt/lampp/htdocs/WordPress/wp-content/plugins/smart-slider-3/ để lấy source code

Trên đây là toàn bộ manual về việc cấu hình lab, các bước exploit sẽ được đề cập tới trong video Exploit và trong quyển nghiên cứu đề tài, chú ý rằng điều kiện cho trước là Attacker đã lấy được tài khoản wordpress admin của victim bằng cách nào đó có thể là bruteforce, phising,... Còn về cách khai thác cũng như quá trình khai thác xin mời đọc bản nghiên cứu và xem video để hiểu rõ.
